{{range $model, $fields := .}}
{{$normalModel := $model.Name}}
{{$lowerModel := $model.LowerName}}
{{$upperModel := $model.UpperName}}
{{$unexportModel := $model.UnexportedName}}
{{$self := $model.Self}}
{{$recv := (printf "(%s *%s)" $self $normalModel)}}
const (
    {{range $index, $field := $fields}}{{with $field}}{{.ConstName}}{{end}} {{if eq $index  0}} uint = iota {{end}}
    {{end}}{{$upperModel}}_FIELDEND
)

func {{$recv}} Table() string {
    return "{{$lowerModel}}"
}

func {{$recv}} FieldValues(fields *types.LightBitSet) []interface{} {
    vals, index := make([]interface{}, 0, fields.BitCount()), 0
    {{range $fields}} if fields.IsSet({{.ConstName}}) {
    vals = append(vals, {{$self}}.{{.Name}})
    index++
    }
    {{end}}return vals
}

func {{$recv}} FieldPtrs(fields *types.LightBitSet) []interface{} {
    vals, index := make([]interface{}, 0, fields.BitCount()), 0
    {{range $fields}} if fields.IsSet({{.ConstName}}) {
    vals = append(vals, &({{$self}}.{{.Name}}))
        index++
    }
    {{end}}return vals
}

func {{$recv}} New() database.Model {
    return new({{$normalModel}})
}
{{end}}
